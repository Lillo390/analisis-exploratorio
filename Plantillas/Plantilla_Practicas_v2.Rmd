---
# Cabecera YAML: especifica las opciones de configuraci칩n del documento (https://m-clark.github.io/Introduction-to-Rmarkdown/customization.html)
#Opciones de cabecera en: https://cran.r-project.org/web/packages/ymlthis/vignettes/yaml-fieldguide.html
title: "Plantilla para la realizaci칩n de informes / memorias"
subtitle: An치lisis Exploratorio de Datos. M치ster en Ciencia de Datos - UV
author: "Marcelino Mart칤nez Sober"
date:  '`r format(Sys.Date(),"%d-%m-%Y")`'  #Pondr칤a la fecha del d칤a actual
params:
  lang: ES
lang: "`r switch(params$lang, ES = 'es-ES', EN = 'en-US')`"
output:
  # html_document:
  #   echo: yes
  #   number_sections: yes
  #   theme: lumen 
  #   toc: yes
  # html_notebook:
  #   echo: yes
  #   number_sections: yes
  #   toc: yes
  pdf_document:
    toc: yes
    toc_depth: 3
    number_sections: yes
language:
  label:
    fig: 'Figura '
    tab: 'Tabla '
    eq: 'Ecuaci칩n '
    thm: 'Teorema '
    lem: 'Lema '
    def: 'Definici칩n '
    cor: 'Corolario '
    prp: 'Proposici칩n '
    exm: 'Ejemplo '
    exr: 'Ejercicio '
    proof: 'Demostraci칩n. '
    remark: 'Nota: '
    solution: 'Soluci칩n. '
urlcolor: blue
lof: TRUE #list of figures
lot: TRUE #list of tables
---

# Documentaci칩n _online_

Puedes encontrar un tutorial muy 칰til sobre __Rmarkdown__ en [https://rmarkdown.rstudio.com/lesson-1.html](https://rmarkdown.rstudio.com/lesson-1.html)

# Previo. Crea un proyecto.

Para cada tarea **crea un nuevo proyecto** con, al menos, una carpeta **./data**, que contenga los datos, (puedes usar carpetas adicionales para organizar la informaci칩n: programas, **./program**, figuras, **./figure**, etc). El proyecto contendr치 al menos un fichero con el c칩digo a ejecutar __\*.Rmd__.

**ATENCI칍N**: No us칠is rutas con espacios o caracteres extra침os.  

+ `c:\TtoDatos` --> SI
<!-- + `c\Ruta de TD Rosa Pe침a 游녨游때游녨` -> NOOOOO!!! -->
+ `c\Ruta de TD Rosa Pe침a Emoticonos` -> NOOOOO!!!

**Esta carpeta es un ejemplo de proyecto**: 

+ **0-Plantilla_RmarkdownPracticas**, es la carpeta de proyecto.  
+ **0-Plantilla_RmarkdownPracticas.Rproj** es el fichero de proyecto que contiene al menos un programa.  
+ **Plantilla_Practicas.Rmd** es el programa.  
+ **data** y **figure** son carpetas locales al proyecto para organizar la informaci칩n. 

Si utilizamos rutas locales, al compartir proyectos basta con comprimir la carpeta del proyecto ya que contendr치 todos los ficheros adicionales necesarios.

Al realizar la compilaci칩n podemos optar por varios formatos de salida. Los m치s habituales son **html** y **pdf**, que especificaremos en las opciones *output* de la cabecera del fichero. Es posible obtener varias salidas simult치neamente.  El fichero de salida tiene el mismo nombre que el fichero del programa.

## Salida **html**

Tenemos 2 opciones **html** y **nb.html** (notebook). Son muy similares si bien **nb.html** tiene caracter칤sticas adicionales ocultar /visualizar el c칩digo (si originalmente estaba visible *echo=TRUE*)

output:  
#   pdf_document: 
#     toc: yes  
#     toc_depth: 3  
#     number_sections: yes  
#   html_notebook:  
#     echo: yes  
#     number_sections: yes  
#     toc: yes  
   html_document:  
     echo: yes  
     number_sections: yes  
     theme: lumen  
     toc: yes

## Salida **pdf**

Para generar documentos **pdf** descomentamos las l칤neas correspondientes.

output:  
   pdf_document: 
     toc: yes  
     toc_depth: 3  
     number_sections: yes  
#   html_notebook:  
#     echo: yes  
#     number_sections: yes  
#     toc: yes  
#   html_document:  
#     echo: yes  
#     number_sections: yes  
#     theme: lumen  
#     toc: yes

En el lenguaje *Markdown* (*Rmarkdown* en nuestro caso), es posible incluir elementos de otros lenguajes como *LaTeX*, ampliamente utilizado para la escritura de documentos cient칤ficos. Por ejemplo usando LaTeX se pueden escribir ecuaciones matem치ticas como:

$$a x^{2}+b x+c=0$$
$$x=\frac{-b \pm \sqrt{b^{2}-4 \cdot a \cdot c}}{2 \cdot a}$$

Para que la compilaci칩n a pdf sea posible es necesario tener instalado en nuestro ordenador un compilador de LaTeX. Una alternativa sencilla que nos permite resolver este problema, es instalar un compilador para usarlo solo dentro de R, para ello debes seguir los siguientes pasos:

### Instalaci칩n [Tinytex](https://yihui.org/tinytex/)


1. Instala la 칰ltima versi칩n de R (La puedes descargar desde Cran R)
2. Instala la 칰ltima versi칩n de RStudio.
3. Desde Rstudio instala la librer칤a *tinytex* para ellos ve escribiendo en la l칤nea de comandos las siguientes instrucciones:
  + `install.packages("tinytex", dependencies = TRUE)` 
  +  `library(tinytex)` 
  +  `tinytex::install_tinytex()` 

El proceso puede tardar unos minutos ya que ocupa unos 200MB.

Una vez finalizado el proceso prueba a compilar a *pdf*.

     
# Opciones generales chunks

+ `include = FALSE` evita que el c칩digo y los resultados aparezcan en el archivo terminado. R Markdown a칰n ejecuta el c칩digo en el fragmento y los resultados pueden ser utilizados por otros fragmentos.
+ `echo = FALSE` evita que el c칩digo, pero no los resultados, aparezcan en el archivo terminado. Esta es una manera 칰til de incrustar figuras.
+ `message = FALSE` evita que los mensajes generados por el c칩digo aparezcan en el archivo finalizado.
+ `warning = FALSE` evita que las advertencias generadas por el c칩digo aparezcan en el informe final.

```{r setup, cache = F, echo = F, message = F, warning = F, tidy = F}

# CONFIGURACI칍N GENERAL
library(knitr)
options(width = 100)
# Opciones generales chunks

#include = FALSE evita que el c칩digo y los resultados aparezcan en el archivo terminado. R Markdown a칰n ejecuta el c칩digo en el fragmento y los resultados pueden ser utilizados por otros fragmentos.
#echo = FALSE evita que el c칩digo, pero no los resultados, aparezcan en el archivo terminado. Esta es una manera 칰til de incrustar figuras.
#message = FALSE evita que los mensajes generados por el c칩digo aparezcan en el archivo finalizado.
#warning = FALSE evita que las advertencias generadas por el c칩digo aparezcan en el final.

#fig.cap = "..." agrega un t칤tulo a los resultados gr치ficos.

opts_chunk$set(echo=F, message = F, error = F, warning = F, comment = NA, fig.align = 'center', dpi = 100, tidy = F, cache.path = '.cache/', fig.path = './figure/')

#options(xtable.type = 'html')
knit_hooks$set(inline = function(x) {
  
  if(is.numeric(x)) {
    round(x, getOption('digits'))
  } else {
    paste(as.character(x), collapse = ', ')
  }
})
#knit_hooks$set(plot = knitr:::hook_plot_html)
```

# Librer칤as cargadas

Incluir la lista de librer칤as necesarias para la ejecuci칩n de c칩digo en 
`packages = c("imager","tidyverse","knitr")`

```{r, echo=FALSE, message=FALSE}
# Especificamos las librer칤as necesarias en esta lista

packages = c("imager","kableExtra","tidyverse","knitr")

#use this function to check if each package is on the local machine
#if a package is installed, it will be loaded
#if any are not, the missing package(s) will be installed and loaded
package.check <- lapply(packages, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE,repos='http://cran.rediris.es')
    library(x, character.only = TRUE)
  }
})

#verify they are loaded
search()

```



# 쮺칩mo inicio el informe /documento / pr치ctica ? 

Haz una breve introducci칩n al problema que se desea resolver.

En este documento se describe   ... bla bla bla

A continuaci칩n ve insertando bloques de c칩digo que vayan ilustrando cada una de las etapas as칤 como los resultados obtenidos.

Utiliza diferentes niveles en los t칤tulos para generar autom치ticamente un 칤ndice.

+ `# T칤tulo`
+ `## Subt칤tulo`
+ `### Subsubt칤tulo`


```{r}



```

# Rutas locales

Usa siempre rutas referidas a la carpeta, en la que se encuentra el fichero fuente, y siempre rutas **relativas** a dicha ubicaci칩n. 

Ejemplos

**ruta1<-'data/tabla1.txt'**  : el fichero est치 en la carpeta datos que cuelga del directorio donde est치 el c칩digo. 

**ruta2<-'./data/tabla1.txt'** : el fichero est치 en la carpeta datos que cuelga de un nivel superior

**ruta3<-'../data/tabla1.txt'** : el fichero est치 en la carpeta datos que cuelga de dos niveles superiores

**ruta4<-'./../data/tabla1.txt'** : el fichero est치 en la carpeta datos que cuelga de tres niveles superiores

ruta5<-'C:/MisDatos/Ej.txt'  **NO USAR NUNCA UNA RUTA ABSOLUTA COMO ESTA**

```{r}



```

# C칩mo incluir figuras.

Hay que tener en cuenta que el aspecto final del docuemento va a depender de si se genera un archivo *html*, o *pdf*, incluso algunas opciones de formato van a ser dependientes del tipo de documento de salida. El documento [Rmarkdown cheat sheet](https://rmarkdown.rstudio.com/lesson-15.html)

## Subapartado. Opci칩n 1.Figuras en fichero.

La figura est치 almacenada en un fichero, en una carpeta local al proyecto.

Podemos controlar las opciones de la figura con par치metros del *chunk* 


```{r fig.cap = "Texto en pie de la figura. Control de tama침o 1 \\label{logoETSE}", fig.height=4, fig.width=4, echo=TRUE, message=FALSE, warning=FALSE}
library(imager)
image <- load.image('figure/logoETSE.png')
plot(image, axes = 0)
```

```{r fig.cap = "Texto en pie de la figura. Control de tama침o 2. \\label{logoGCD}", out.width='20%', echo=FALSE, message=FALSE, warning=FALSE}
library(imager)
#image <- load.image('figure/logoGCD.pdf')
image<-imager::load.image('figure/logoETSE.png')
plot(image, axes = 0)
```
Preferiblemente utiliza im치genes en formato **png** aunque tambi칠n se aceptan otros formatos.

En el texto podemos referenciar autom치ticamente las figuras usando `\ref{etiqueta}` con el mismo nombre de etiqueta asociado con `\label{etiqueta}`. Ten en encuenta que no puede haber dos etiquetas iguales.  

En \ref{logoETSE} tenemos una figura en la que se controla anchura y altura y en \ref{logoGCD} se utiliza un porcentaje sobre el tama침o original de al figura.

## Subapartado. Opci칩n 2.Figuras generadas en ejecuci칩n.

Dibujamos la gr치fica en un *chunk* que nombraremos, por ejemplo. El siguiente se denomina  **presFig**

```{r presFig, echo=FALSE,fig.cap="Referencia a figura a partir del nombre del chunk. \\label{fig::presFig}", out.width='50%', echo=TRUE, message=FALSE, warning=FALSE}
plot(pressure)
```
Podemos referenciar a la figura usando `\ref{fig::presFig}`. 

Por ejemplo dir칤amos que en la figura \ref{fig::presFig} se observa que al aumentar la variable `temperature` aumenta la variable `pressure`.

Ten en cuenta que la numeraci칩n de las figuras es autom치tica.

# C칩mo incluir tablas de resultados.
Tambi칠n podemos mostrar la informaci칩n en forma de tabla 
La librer칤a `kableExtra` [https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html) te permite personalizar tus tablas con un sinf칤n de posibilidades. Tanto en formato _html_ como _pdf_ [https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf](https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf)


```{r echo=FALSE, message=FALSE, warning=FALSE}
knitr::kable(pressure,caption="Valores de las variables mostrados en la figura \\ref{fig::presFig}. \\label{EventosFallo}")
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
knitr::kable(pressure,caption="Valores de las variables mostrados en la figura \\ref{fig::presFig}. \\label{EventosFallo}")%>%kable_styling()
```

